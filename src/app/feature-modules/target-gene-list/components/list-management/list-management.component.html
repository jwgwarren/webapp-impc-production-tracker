<mat-accordion *ngIf="canUpdateList">
  <mat-expansion-panel>
    <mat-expansion-panel-header>
      <mat-panel-title>
        <mat-icon appearance="outline" aria-hidden="false" aria-label="outline home icon">cloud_upload_outline
        </mat-icon>
      </mat-panel-title>
      <mat-panel-description>
        Import Gene list
      </mat-panel-description>
    </mat-expansion-panel-header>

    <mat-card>
      <mat-card-content>
        Choose a csv file providing the Consortium Name, the Target(s) and a optional note:
        <pre>
          Consortium,Target(s),Note
          CMG,gene1,Note 1
          CMG,"gene2, gene3",Note 2
        </pre>
        <strong>Note:</strong>The loaded data will be added to the existing one. The associated projects will be
        calculated once you click the button 'Update lists'.
      </mat-card-content>
      <mat-card-actions>
        <app-csvloader (dataChange)='changeLists($event)'></app-csvloader>
      </mat-card-actions>
    </mat-card>

  </mat-expansion-panel>
</mat-accordion>

<div [formGroup]="form">
  <mat-card>
    <mat-card-content>
      <table class="mat-elevation-z8">
        <thead>
          <tr>
            <th>Consortium</th>
            <th>Gene(s)</th>
            <th>Note</th>
            <th>Associated Projects</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let element of dataSource">
            <div *ngIf="canUpdateList; then editableConsortium else readOnlyConsortium">
            </div>
            <ng-template #editableConsortium>
              <td>
                <mat-select placeholder="Consortium" [(value)]="element.consortiumName">
                  <mat-option *ngFor="let consortium of consortia" [value]="consortium.name" required>
                    {{consortium.name}}
                  </mat-option>
                </mat-select>
              </td>
            </ng-template>
            <ng-template #readOnlyConsortium>
              <td>{{ element.consortiumName }}</td>
            </ng-template>

            <td>{{ getGenesSymbols(element) }}

              <mat-form-field>
                <input type="text" (focus)="onFocus($event)" (focusout)="onFocusOut($event)" (input)="onSearchChange($event.target.value)" matInput formControlName="{{ 'genesForm_' + element.targetListElement.id }}" [matAutocomplete]="auto">
                <mat-autocomplete #auto="matAutocomplete">
                    <mat-option *ngFor="let option of filteredOptions | async" [value]="option">
                      {{ option }}
                    </mat-option>
                  </mat-autocomplete>
              </mat-form-field>
              
            </td>
            <td>{{ element.targetListElement.note }}</td>
            <td>
              <div *ngFor="let project of element.targetListElement.projects">
                <div *ngIf="project">
                  <a routerLink="/projects/{{ project.tpn }}">{{ project.tpn }}</a> [
                  {{ project.assignmentStatusName || 'Status not defined' }} ]
                </div>
              </div>
            </td>
          </tr>
        </tbody>
      </table>

    </mat-card-content>
    <mat-card-actions *ngIf="canUpdateList">
      <button [disabled]='false' (click)="updateLists()" mat-raised-button color="primary">Update lists</button>
    </mat-card-actions>
  </mat-card>
</div>